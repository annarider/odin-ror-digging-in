<div class="container mx-auto px-4 py-8 max-w-3xl">
  <%# Back to Feed Link %>
  <div class="mb-6">
    <%= link_to posts_path, class: "text-mineral-blue hover:text-mineral-blue/80 flex items-center space-x-2" do %>
      <span>‚Üê Back to Feed</span>
    <% end %>
  </div>

  <%# Post Card %>
  <article class="card p-8 mb-6">
    <%# Post Header %>
    <div class="flex items-center space-x-4 mb-6">
      <%= link_to user_path(@post.user), class: "flex-shrink-0" do %>
        <%= image_tag @post.user.profile_picture_url(size: 60),
            alt: "#{@post.user.name}'s profile picture",
            class: "w-16 h-16 rounded-full border-2 border-living-moss" %>
      <% end %>
      <div class="flex-1">
        <h2 class="font-bold text-xl text-midnight-soil">
          <%= link_to @post.user.name, user_path(@post.user), class: "hover:text-mineral-blue transition-colors" %>
        </h2>
        <p class="text-slate-mist text-sm">
          <%= @post.created_at.strftime("%B %d, %Y at %I:%M %p") %>
        </p>
      </div>
    </div>

    <%# Post Content %>
    <div class="mb-6">
      <p class="text-midnight-soil text-lg leading-relaxed whitespace-pre-wrap"><%= @post.content %></p>
    </div>

    <%# Post Image %>
    <% if @post.image %>
      <div class="mb-6 rounded-lg overflow-hidden">
        <%= image_tag @post.image, class: "w-full" %>
      </div>
    <% end %>

    <%# Likes Count & Action %>
    <div class="flex items-center justify-between py-4 border-t border-b border-slate-mist/20 mb-6">
      <span class="flex items-center space-x-2 text-slate-mist">
        <span class="text-living-moss text-xl">‚ù§Ô∏è</span>
        <strong class="text-midnight-soil text-lg"><%= @post.likes.count %></strong>
        <span><%= "like".pluralize(@post.likes.count) %></span>
      </span>

      <% if @post.likes.exists?(user: current_user) %>
        <% user_like = @post.likes.find_by(user: current_user) %>
        <%= button_to like_path(user_like), method: :delete, class: "btn bg-living-moss text-white hover:bg-living-moss/80" do %>
          ‚ù§Ô∏è Liked
        <% end %>
      <% else %>
        <%= button_to post_likes_path(@post), method: :post, class: "btn bg-white border-2 border-living-moss text-living-moss hover:bg-living-moss hover:text-white" do %>
          ü§ç Like this post
        <% end %>
      <% end %>
    </div>

    <%# Manage Post (Owner Only) %>
    <% if @post.user == current_user %>
      <div class="flex items-center space-x-3 pt-4 border-t border-slate-mist/20">
        <%= link_to edit_post_path(@post), class: "btn bg-sunstruck-gold text-white hover:bg-sunstruck-gold/90" do %>
          ‚úèÔ∏è Edit Post
        <% end %>
        <%= button_to post_path(@post), method: :delete, form: { data: { turbo_confirm: 'Are you sure you want to delete this post?' } }, class: "btn btn-danger" do %>
          üóëÔ∏è Delete Post
        <% end %>
      </div>
    <% end %>
  </article>

  <%# Comments Section %>
  <div class="card p-8">
    <h3 class="text-2xl font-bold text-midnight-soil mb-6 flex items-center space-x-2">
      <span>üí¨</span>
      <span>Comments (<%= @post.comments.count %>)</span>
    </h3>

    <%# Comments List %>
    <div class="space-y-6 mb-8">
      <% @post.comments.select(&:persisted?).each do |comment| %>
        <div class="bg-stone-white p-4 rounded-lg">
          <%# Comment Header %>
          <div class="flex items-start space-x-3 mb-3">
            <%= link_to user_path(comment.user), class: "flex-shrink-0" do %>
              <%= image_tag comment.user.profile_picture_url(size: 40),
                  alt: "#{comment.user.name}'s profile picture",
                  class: "w-10 h-10 rounded-full border-2 border-mineral-blue" %>
            <% end %>
            <div class="flex-1">
              <div class="flex items-baseline space-x-2">
                <strong class="text-midnight-soil">
                  <%= link_to comment.user.name, user_path(comment.user), class: "hover:text-mineral-blue transition-colors" %>
                </strong>
                <span class="text-sm text-slate-mist">
                  <%= time_ago_in_words(comment.created_at) %> ago
                </span>
              </div>
              <p class="text-midnight-soil mt-2 leading-relaxed"><%= comment.content %></p>
            </div>
          </div>

          <%# Comment Actions %>
          <div class="flex items-center space-x-4 ml-13 text-sm">
            <span class="text-slate-mist">
              <strong class="text-midnight-soil"><%= comment.likes.count %></strong>
              <%= "like".pluralize(comment.likes.count) %>
            </span>

            <% if comment.likes.exists?(user: current_user) %>
              <% user_like = comment.likes.find_by(user: current_user) %>
              <%= button_to like_path(user_like), method: :delete, class: "text-living-moss hover:text-living-moss/80 font-medium" do %>
                ‚ù§Ô∏è Liked
              <% end %>
            <% else %>
              <%= button_to comment_likes_path(comment), method: :post, class: "text-slate-mist hover:text-living-moss font-medium" do %>
                ü§ç Like
              <% end %>
            <% end %>

            <% if comment.user == current_user %>
              <%= button_to comment_path(comment), method: :delete, form: { data: { turbo_confirm: "Delete this comment?" } }, class: "text-red-500 hover:text-red-600 font-medium" do %>
                Delete
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>

      <%# Empty State for Comments %>
      <% if @post.comments.empty? %>
        <div class="text-center py-8 text-slate-mist">
          <p>No comments yet. Be the first to share your thoughts! üå±</p>
        </div>
      <% end %>
    </div>

    <%# New Comment Form %>
    <div class="border-t border-slate-mist/20 pt-6">
      <h4 class="text-lg font-semibold text-midnight-soil mb-4">Add a comment</h4>
      <%= form_with model: [ @post, Comment.new ], url: post_comments_path(@post), local: true, class: "space-y-4" do |f| %>
        <div>
          <%= f.text_area :content,
              rows: 3,
              placeholder: "Share your gardening wisdom...",
              required: true,
              class: "textarea-field" %>
        </div>
        <%= f.submit "Post Comment", class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>
